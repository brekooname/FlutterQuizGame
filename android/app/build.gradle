def localProperties = new Properties()
def localPropertiesFile = rootProject.file('local.properties')
if (localPropertiesFile.exists()) {
    localPropertiesFile.withReader('UTF-8') { reader ->
        localProperties.load(reader)
    }
}

def flutterRoot = localProperties.getProperty('flutter.sdk')
if (flutterRoot == null) {
    throw new GradleException("Flutter SDK not found. Define location with flutter.sdk in the local.properties file.")
}

def flutterVersionCode = localProperties.getProperty('flutter.versionCode')
if (flutterVersionCode == null) {
    flutterVersionCode = '1'
}

def flutterVersionName = localProperties.getProperty('flutter.versionName')
if (flutterVersionName == null) {
    flutterVersionName = '1.0'
}

apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
apply from: "$flutterRoot/packages/flutter_tools/gradle/flutter.gradle"

android {
    compileSdkVersion 31

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }

    kotlinOptions {
        jvmTarget = '1.8'
    }

    sourceSets {

        main.java.srcDirs += 'src/main/kotlin'

        history {
            assets.srcDirs = ['assets/implementations/history', 'assets/main']
        }
        historyPro {
            assets.srcDirs = ['assets/implementations/history', 'assets/main']
        }
        geoquiz {
            assets.srcDirs = ['assets/implementations/geoquiz', 'assets/main']
        }
        geoquizPro {
            assets.srcDirs = ['assets/implementations/geoquiz', 'assets/main']
        }
        perstest {
            assets.srcDirs = ['assets/implementations/perstest', 'assets/main']
        }
        perstestPro {
            assets.srcDirs = ['assets/implementations/perstest', 'assets/main']
        }
        dopewars {
            assets.srcDirs = ['assets/implementations/dopewars', 'assets/main']
        }
        dopewarsPro {
            assets.srcDirs = ['assets/implementations/dopewars', 'assets/main']
        }
        anatomy {
            assets.srcDirs = ['assets/implementations/anatomy', 'assets/main']
        }
        anatomyPro {
            assets.srcDirs = ['assets/implementations/anatomy', 'assets/main']
        }
        iqgame {
            assets.srcDirs = ['assets/implementations/iqgame', 'assets/main']
        }
        iqgamePro {
            assets.srcDirs = ['assets/implementations/iqgame', 'assets/main']
        }
    }

    defaultConfig {
        // TODO: Specify your own unique Application ID (https://developer.android.com/studio/build/application-id.html).
        applicationId "com.habapps"
        minSdkVersion 19
        targetSdkVersion 30
        versionCode flutterVersionCode.toInteger()
        versionName flutterVersionName
        multiDexEnabled true
    }

    buildTypes {
        release {
            // TODO: Add your own signing config for the release build.
            // Signing with the debug keys for now, so `flutter run --release` works.
            signingConfig signingConfigs.debug
        }
    }

    flavorDimensions "game"
    productFlavors {
/////////////////////////////////////////////////////////////////////////////
        anatomy {
            applicationIdSuffix ".iqtest"
            versionCode 6
            versionName "2.0"
            dimension "game"
            manifestPlaceholders = [appIcon: "@drawable/iqgame_icon"]
        }
/////////////////////////////////////////////////////////////////////////////
        anatomyPro {
            applicationIdSuffix ".iqtestPro"
            versionCode 3
            versionName "2.0"
            dimension "game"
            manifestPlaceholders = [appIcon: "@drawable/iqgamepro_icon"]
        }
/////////////////////////////////////////////////////////////////////////////
        anatomy {
            applicationIdSuffix ".anatomy"
            versionCode 3
            versionName "1.2"
            dimension "game"
            manifestPlaceholders = [appIcon: "@drawable/anatomy_icon"]
        }
/////////////////////////////////////////////////////////////////////////////
        anatomyPro {
            applicationIdSuffix ".anatomypro"
            versionCode 3
            versionName "1.2"
            dimension "game"
            manifestPlaceholders = [appIcon: "@drawable/anatomypro_icon"]
        }
/////////////////////////////////////////////////////////////////////////////
        dopewars {
            applicationIdSuffix ".resourcewars"
            versionCode 2
            versionName "1.1"
            dimension "game"
            manifestPlaceholders = [appIcon: "@drawable/dopewars_icon"]
        }
/////////////////////////////////////////////////////////////////////////////
        dopewarsPro {
            applicationIdSuffix ".resourcewarspro"
            versionCode 2
            versionName "1.1"
            dimension "game"
            manifestPlaceholders = [appIcon: "@drawable/dopewarspro_icon"]
        }
/////////////////////////////////////////////////////////////////////////////
        perstest {
            applicationIdSuffix ".perstest"
            versionCode 7
            versionName "1.5"
            dimension "game"
            manifestPlaceholders = [appIcon: "@drawable/perstest_icon"]
        }
/////////////////////////////////////////////////////////////////////////////
        perstestPro {
            applicationIdSuffix ".perstestPro"
            versionCode 2
            versionName "1.1"
            dimension "game"
            manifestPlaceholders = [appIcon: "@drawable/perstestpro_icon"]
        }
/////////////////////////////////////////////////////////////////////////////
        geoquiz {
            applicationIdSuffix ".geoquiz"
            versionCode 5
            versionName "1.3"
            dimension "game"
            manifestPlaceholders = [appIcon: "@drawable/geoquiz_icon"]
        }
/////////////////////////////////////////////////////////////////////////////
        geoquizPro {
            applicationIdSuffix ".geoquizpro"
            versionCode 2
            versionName "1.1"
            dimension "game"
            manifestPlaceholders = [appIcon: "@drawable/geoquizpro_icon"]
        }
/////////////////////////////////////////////////////////////////////////////
        history {
            applicationIdSuffix ".history"
            versionCode 11
            versionName "1.19"
            dimension "game"
            manifestPlaceholders = [appIcon: "@drawable/history_icon"]
        }
/////////////////////////////////////////////////////////////////////////////
        historyPro {
            applicationIdSuffix ".historypro"
            versionCode 3
            versionName "1.11"
            dimension "game"
            manifestPlaceholders = [appIcon: "@drawable/historypro_icon"]
        }
/////////////////////////////////////////////////////////////////////////////
    }
}

flutter {
    source '../..'
}

dependencies {
    implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk7:$kotlin_version"
    implementation 'com.android.support:multidex:1.0.3'
}
